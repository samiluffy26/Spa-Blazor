@page "/services"
@using spa_reservas_blazor.Shared.Entities
@using spa_reservas_blazor.Services
@inject IBookingService BookingService

@rendermode @(new InteractiveWebAssemblyRenderMode(prerender: false))

<PageTitle>Nuestros Servicios - RelaxSpa</PageTitle>

<div class="min-h-screen bg-sage-50 py-12">
    <div class="container-custom">
        
        @* Header *@
        <div class="text-center mb-16 animate-fadeIn">
            <span class="inline-block px-4 py-2 bg-white text-sage-700 rounded-full text-sm font-medium shadow-sm mb-4">
                Menú de Tratamientos
            </span>
            <h1 class="text-4xl md:text-5xl font-serif font-bold text-gray-900 mb-6">
                Descubre tu momento de paz
            </h1>
            <p class="text-lg text-gray-600 max-w-2xl mx-auto">
                Cada tratamiento está diseñado para proporcionarte una experiencia única 
                de relajación y renovación.
            </p>
        </div>

        @* Categorías *@
        <div class="flex flex-wrap justify-center gap-4 mb-12 animate-fadeIn">
            <button @onclick="() => FilterByCategory(ALL_CATEGORY)"
                    class="px-6 py-3 rounded-full font-medium transition-all duration-300 @(SelectedCategory == ALL_CATEGORY ? "bg-primary-600 text-white shadow-lg scale-105" : "bg-white text-gray-600 hover:bg-white/80 hover:shadow-md")">
                Todos
            </button>
            @foreach (var category in DynamicCategories)
            {
                <button @onclick="() => FilterByCategory(category.Name)"
                        class="px-6 py-3 rounded-full font-medium transition-all duration-300 @(SelectedCategory == category.Name ? "bg-primary-600 text-white shadow-lg scale-105" : "bg-white text-gray-600 hover:bg-white/80 hover:shadow-md")">
                    @category.Name
                </button>
            }
        </div>

        @* Grid de Servicios *@
        <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8 animate-slideUp">
            @foreach (var service in FilteredServices)
            {
                <ServiceCard Service="service" />
            }
        </div>

        @* Empty State *@
        @if (!FilteredServices.Any())
        {
            <div class="text-center py-20">
                <p class="text-gray-500 text-lg">No se encontraron servicios en esta categoría.</p>
                <button @onclick="() => FilterByCategory(ALL_CATEGORY)" class="mt-4 text-primary-600 font-medium hover:underline">
                    Ver todos los servicios
                </button>
            </div>
        }
    </div>
</div>

@code {
    private const string ALL_CATEGORY = "all";
    private string SelectedCategory = ALL_CATEGORY;
    private List<Service> AllServices = new();
    private List<Service> FilteredServices = new();
    private List<Category> DynamicCategories = new();

    protected override async Task OnInitializedAsync()
    {
        // Cargar datos
        AllServices = await BookingService.GetServicesAsync();
        DynamicCategories = await BookingService.GetCategoriesAsync();
        
        FilterByCategory(ALL_CATEGORY);
    }

    private void FilterByCategory(string category)
    {
        SelectedCategory = category;
        if (category == ALL_CATEGORY)
        {
            FilteredServices = AllServices;
        }
        else
        {
            FilteredServices = AllServices
                .Where(s => string.Equals(s.Category, category, StringComparison.OrdinalIgnoreCase))
                .ToList();
        }
        StateHasChanged();
    }
}
